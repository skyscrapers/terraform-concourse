---
platform: linux
image_resource:
  type: docker-image
  source:
    repository: golang
    tag: 1.9-alpine

params:
  AWS_DEFAULT_REGION: eu-west-1
  TF_VERSION:
  TEST_ACM_ARN:
  TEST_CONCOURSE_VERSION:
  TEST_KEY_NAME:
  AWS_ACCESS_KEY_ID:
  AWS_SECRET_ACCESS_KEY:
  AWS_SESSION_TOKEN:

inputs:
- name: terraform-src
  path: gopath/src/github.com/skyscrapers/terraform-concourse

run:
  path: sh
  args:
    - -exc
    - |
      export GOPATH=$PWD/gopath
      cd gopath/src/github.com/skyscrapers/terraform-concourse/test
      ./setup.sh
      dep ensure
      go test -v -timeout 60m
